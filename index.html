<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corners Predictor v12 ‚Äì 6 ≈πR√ìDE≈Å | 60%+</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f0f23, #1a1a2e);
            color: #fff;
            text-align: center;
            padding: 20px;
            min-height: 100vh;
        }
        h1 { color: #ff5722; font-size: 2em; margin-bottom: 10px; }
        .subtitle { color: #aaa; margin-bottom: 20px; }
        .buttons { margin: 20px 0; }
        button {
            background: #ff5722; color: white; border: none; padding: 14px 28px; margin: 8px;
            font-size: 16px; font-weight: bold; cursor: pointer; border-radius: 12px;
            transition: all 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        button:hover { background: #e64a19; transform: translateY(-2px); }
        table {
            width: 100%; max-width: 1200px; margin: 25px auto; border-collapse: collapse;
            background: #1a1a2e; border-radius: 12px; overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
        th { background: #16213e; padding: 16px; font-weight: bold; text-transform: uppercase; font-size: 0.9em; }
        td { padding: 14px; border-bottom: 1px solid #333; }
        tr:hover { background: #222840; }
        .hit { background: #2e7d32 !important; animation: pulse 1s; color: #fff; }
        .miss { background: #c62828 !important; color: #fff; }
        .pending { background: #ff8f00; color: #000; font-weight: bold; }
        .medium { color: #ffd700; font-weight: bold; }
        .high { color: #00ff00; font-weight: bold; }
        .link { color: #4fc3f7; text-decoration: underline; cursor: pointer; }
        #stats {
            font-size: 1.3em; margin: 25px 0; padding: 15px;
            background: rgba(255, 87, 34, 0.1); border-radius: 12px; display: inline-block;
        }
        canvas { margin: 30px auto; max-width: 400px; }
        .loader {
            display: inline-block; width: 20px; height: 20px;
            border: 3px solid #f3f3f3; border-top: 3px solid #ff5722;
            border-radius: 50%; animation: spin 1s linear infinite; margin-left: 10px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
        footer { margin-top: 50px; font-size: 0.9em; color: #888; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Corners Predictor <span id="version">v1.01</span> <span id="loader" class="loader" style="display:none;"></span></h1>
        <p class="subtitle">üîß DEBUG MODE - TYLKO SPORTMONKS - wszystkie inne API wy≈ÇƒÖczone</p>

        <div class="buttons">
            <button onclick="loadTodayMatches()">SZUKAJ MECZ√ìW NA DZI≈ö</button>
            <button onclick="loadMatchesForDate(1)">JUTRO</button>
            <button onclick="loadMatchesForDate(-1)">WCZORAJ</button>
            <button onclick="verifyAll()">SPRAWD≈π WYNIKI</button>
        </div>

        <p id="info">Kliknij przycisk, by pobraƒá mecze na dzi≈õ...</p>
        <p id="api-status" style="font-size: 0.9em; color: #ffa500; margin-top: 10px;"></p>

        <table id="predictions" style="display:none;">
            <tr>
                <th>Mecz</th>
                <th>Liga</th>
                <th>≈örednia %</th>
                <th>ZGODNO≈öƒÜ</th>
                <th>Link</th>
                <th>Status</th>
            </tr>
        </table>

        <div id="stats">Hit Rate: ‚Äî | ROI: ‚Äî</div>
        <canvas id="chart"></canvas>

        <footer>
            <p>CornersBot v12 ¬© 2025 | 6 ≈∫r√≥de≈Ç | corsproxy.io</p>
        </footer>
    </div>

    <script>
        // === KLUCZE (UKRYTE) ===
        const SPORTMONKS_KEY = 'zWSF4VIJJHhBOw4xizgqFPS795qiOdxes0y9B1AhqeBeAKBLrKx8283Ivsks';
        const FOOTYSTATS_KEY = '8cdad7757b702fae3b792c0b3328017ee33cc17594b18ea8a2717cdc53162325';
        
        // Mo≈ºesz dodaƒá wiƒôcej kluczy API-Football (je≈õli masz)
        const API_FOOTBALL_KEYS = [
            'fb9b429fc619754e0ce3ad2a9e5be39b',
            // 'DODAJ_TUTAJ_KOLEJNY_KLUCZ_JE≈öLI_MASZ',
            // 'I_KOLEJNY',
        ];
        let currentKeyIndex = 0;

        // === PROXY (DZIA≈ÅA Z HEADERAMI!) ===
        const PROXY = 'https://corsproxy.io/?';

        let predictions = [];
        let hits = 0, total = 0;
        let chartInstance = null;
        let apiFootballLimitReached = false;

        // Za≈Çaduj wersjƒô przy starcie
        async function loadVersion() {
            try {
                const response = await fetch('version.json?t=' + Date.now());
                const data = await response.json();
                document.getElementById('version').textContent = 'v' + data.version;
                console.log('üìå Wersja aplikacji:', data.version, '| Ostatnia aktualizacja:', data.updated);
            } catch (e) {
                console.warn('Nie mo≈ºna za≈Çadowaƒá wersji:', e);
            }
        }
        
        // Uruchom przy ≈Çadowaniu strony
        loadVersion();

        // Funkcja pomocnicza do przetwarzania mecz√≥w
        async function processFixtures(fixtures) {
                for (let fix of fixtures) {
                    const home = fix.teams.home.name;
                    const away = fix.teams.away.name;
                    const league = fix.league.name;
                    const id = fix.fixture.id;
                    const flashscore = `https://www.flashscore.pl/mecz/${home.toLowerCase().replace(/ /g,'-')}-${away.toLowerCase().replace(/ /g,'-')}/${id}/`;

                console.log(`\nüéØ Analizujƒô: ${home} vs ${away}`);

                    const probs = await getAllProbabilities(home, away, id, league);
                if (!probs) {
                    console.log('‚ùå B≈ÇƒÖd pobierania prawdopodobie≈Ñstw');
                    continue;
                }

                console.log('üìä Prawdopodobie≈Ñstwa:', probs);

                    const avgProb = Math.round(probs.reduce((a, b) => a + b, 0) / 6);
                    const agree = Math.round(probs.filter(p => p >= 60).length / 6 * 100);

                console.log(`üìà ≈örednia: ${avgProb}% | Zgodno≈õƒá: ${agree}%`);

                    if (agree >= 50) {
                    console.log('‚úÖ Mecz spe≈Çnia kryteria (‚â•50%)!');
                        predictions.push({
                            match: `${home} vs ${away}`,
                            league,
                            avgProb,
                            agree,
                            flashscore,
                            id,
                            status: 'Oczekuje'
                        });
                } else {
                    console.log('‚ùå Mecz NIE spe≈Çnia kryteri√≥w (zgodno≈õƒá < 50%)');
                }
            }
        }

        async function loadMatchesForDate(daysOffset = 0) {
            document.getElementById('loader').style.display = 'inline-block';
            document.getElementById('info').textContent = 'üîß DEBUG: Testujƒô tylko Sportmonks API...';
            document.getElementById('predictions').style.display = 'none';
            predictions = [];

            try {
                const date = new Date();
                date.setDate(date.getDate() + daysOffset);
                const dateStr = date.toISOString().split('T')[0];
                
                console.log('üîç Pobieranie mecz√≥w na:', dateStr);
                console.log('‚ö†Ô∏è API-FOOTBALL TYMCZASOWO WY≈ÅƒÑCZONE - u≈ºywam Sportmonks');
                document.getElementById('api-status').innerHTML = '‚ö†Ô∏è <strong>API-Football wy≈ÇƒÖczone (test)</strong> - u≈ºywam Sportmonks';
                
                // TYMCZASOWO: Od razu u≈ºywaj Sportmonks zamiast API-Football
                let fixtures = null;
                
                // Pr√≥buj Sportmonks jako g≈Ç√≥wne ≈∫r√≥d≈Ço
                console.log('üîÑ U≈ºywam Sportmonks jako g≈Ç√≥wnego ≈∫r√≥d≈Ça...');
                
                // PR√ìBA 1: BEZ PROXY (mo≈ºe CORS dzia≈Ça bezpo≈õrednio)
                // DODANO: include=league ≈ºeby pobraƒá nazwƒô ligi
                const sportmonksUrlDirect = `https://api.sportmonks.com/v3/football/fixtures/date/${dateStr}?api_token=${SPORTMONKS_KEY}&include=league`;
                console.log('üì° Sportmonks URL (BEZPO≈öREDNIO, z league):', sportmonksUrlDirect);
                console.log('üìÖ Data szukania:', dateStr);
                
                let smRes = await fetch(sportmonksUrlDirect);
                console.log('üìù Sportmonks Status (direct):', smRes.status);
                
                // Je≈õli CORS blokuje, spr√≥buj z proxy
                if (!smRes.ok && smRes.status === 0) {
                    console.log('üîÑ CORS zablokowa≈Ç - pr√≥bujƒô z proxy...');
                    const sportmonksUrlProxy = `${PROXY}https://api.sportmonks.com/v3/football/fixtures/date/${dateStr}?api_token=${SPORTMONKS_KEY}&include=league`;
                    console.log('üì° Sportmonks URL (PROXY, z league):', sportmonksUrlProxy);
                    smRes = await fetch(sportmonksUrlProxy);
                    console.log('üìù Sportmonks Status (proxy):', smRes.status);
                }
                
                console.log('üìù Sportmonks Status Text:', smRes.statusText);
                console.log('üìù Sportmonks Headers:', Array.from(smRes.headers.entries()));
                
                // Sprawd≈∫ content-type przed parsowaniem
                const contentType = smRes.headers.get('content-type');
                console.log('üìù Content-Type:', contentType);
                
                let smData;
                if (contentType && contentType.includes('application/json')) {
                    smData = await smRes.json();
                } else {
                    // Odpowied≈∫ nie jest JSON (prawdopodobnie HTML z b≈Çƒôdem)
                    const textResponse = await smRes.text();
                    console.error('‚ùå Odpowied≈∫ NIE JEST JSON:', textResponse.substring(0, 200));
                    throw new Error(`Sportmonks zwr√≥ci≈Ço ${smRes.status}: ${textResponse.substring(0, 100)}`);
                }
                console.log('üì¶ Sportmonks PE≈ÅNA ODPOWIED≈π:', JSON.stringify(smData, null, 2));
                
                if (smRes.ok) {
                    console.log('‚úÖ Sportmonks odpowied≈∫ OK');
                    console.log('üìä Struktura odpowiedzi:', Object.keys(smData));
                    
                    if (smData.data && smData.data.length > 0) {
                        console.log(`‚úÖ [Sportmonks] Znaleziono ${smData.data.length} mecz√≥w`);
                        console.log('üìã Przyk≈Çadowy mecz (pierwszy):', smData.data[0]);
                        console.log('üîë Klucze meczu:', Object.keys(smData.data[0]));
                        
                        // Sprawd≈∫my strukturƒô pierwszego meczu
                        const firstMatch = smData.data[0];
                        console.log('üè† Home team:', firstMatch.home_team || firstMatch.localteam || firstMatch.teams);
                        console.log('üöÄ Away team:', firstMatch.away_team || firstMatch.visitorteam || firstMatch.teams);
                        console.log('üèÜ Liga:', firstMatch.league || firstMatch.league_id);
                        
                        fixtures = smData.data.slice(0, 30).map(fix => {
                            // Parsuj pole "name" kt√≥re ma format "Team1 vs Team2"
                            const matchName = fix.name || '';
                            const teams = matchName.split(' vs ');
                            const homeName = teams[0]?.trim() || 'Unknown';
                            const awayName = teams[1]?.trim() || 'Unknown';
                            
                            // Pobierz nazwƒô ligi z include (je≈õli jest)
                            let leagueName = 'Unknown League';
                            if (fix.league && fix.league.name) {
                                leagueName = fix.league.name;
                            } else if (fix.league_id) {
                                leagueName = `Liga ID: ${fix.league_id}`;
                            }
                            
                            return {
                                fixture: { id: fix.id },
                                teams: {
                                    home: { name: homeName },
                                    away: { name: awayName }
                                },
                                league: { name: leagueName }
                            };
                        });
                    }
                } else {
                    console.error('‚ùå Sportmonks b≈ÇƒÖd:', smRes.status, smRes.statusText);
                    console.error('üì¶ Odpowied≈∫ b≈Çƒôdu Sportmonks:', smData);
                    
                    // Sprawd≈∫ czy jest komunikat b≈Çƒôdu w odpowiedzi
                    if (smData.message) {
                        console.error('üí¨ Komunikat b≈Çƒôdu:', smData.message);
                    }
                    if (smData.errors) {
                        console.error('‚ö†Ô∏è Szczeg√≥≈Çy b≈Çƒôdu:', smData.errors);
                    }
                }
                
                if (!fixtures || fixtures.length === 0) {
                    console.error('‚ùå Brak mecz√≥w ze Sportmonks');
                    console.error('üîç Mo≈ºliwe przyczyny:');
                    console.error('   - Nieprawid≈Çowy endpoint API');
                    console.error('   - Nieprawid≈Çowy format daty:', dateStr);
                    console.error('   - Problemy z kluczem API');
                    console.error('   - Limit zapyta≈Ñ osiƒÖgniƒôty');
                    
                    document.getElementById('info').innerHTML = `
                        ‚ùå B≈ÇƒÖd Sportmonks (${smRes.status})<br>
                        Sprawd≈∫ konsolƒô (F12) aby zobaczyƒá szczeg√≥≈Çy
                    `;
                    document.getElementById('loader').style.display = 'none';
                    return;
                }
                
                console.log(`‚öΩ Znaleziono ${fixtures.length} mecz√≥w ze Sportmonks`);
                document.getElementById('api-status').innerHTML = '‚úÖ <strong>Sportmonks dzia≈Ça poprawnie</strong> (API-Football wy≈ÇƒÖczone do testu)';
                
                // Przetw√≥rz mecze ze Sportmonks
                await processFixtures(fixtures);
                displayResults();
            } catch (e) {
                console.error('üí• B≈ÅƒÑD:', e);
                document.getElementById('info').textContent = 'B≈ÇƒÖd: ' + e.message;
            }
            document.getElementById('loader').style.display = 'none';
        }

        async function loadTodayMatches() {
            return loadMatchesForDate(0);
        }


        async function getAllProbabilities(home, away, id, league) {
            try {
                console.log('  üì° WSZYSTKIE API WY≈ÅƒÑCZONE - TEST MODE - u≈ºywam warto≈õci domy≈õlnych');
                
                // WSZYSTKO WY≈ÅƒÑCZONE NA CZAS TEST√ìW SPORTMONKS
                const p1 = 65; // Sportmonks - warto≈õƒá domy≈õlna
                const p2 = 62; // FootyStats - warto≈õƒá domy≈õlna
                const p3 = 65; // API-Football - wy≈ÇƒÖczone
                const p4 = 70; // TotalCorner - wy≈ÇƒÖczone
                const p5 = 68; // BetOnCorners - wy≈ÇƒÖczone
                const p6 = 66; // CornerStat - wy≈ÇƒÖczone
                
                console.log(`  1Ô∏è‚É£ Sportmonks: ${p1}% (DOMY≈öLNA)`);
                console.log(`  2Ô∏è‚É£ FootyStats: ${p2}% (DOMY≈öLNA)`);
                console.log(`  3Ô∏è‚É£ API-Football: ${p3}% (WY≈ÅƒÑCZONE)`);
                console.log(`  4Ô∏è‚É£ TotalCorner: ${p4}% (DOMY≈öLNA)`);
                console.log(`  5Ô∏è‚É£ BetOnCorners: ${p5}% (DOMY≈öLNA)`);
                console.log(`  6Ô∏è‚É£ CornerStat: ${p6}% (DOMY≈öLNA)`);
                return [p1, p2, p3, p4, p5, p6];
            } catch (e) {
                console.error('  ‚ùå B≈ÇƒÖd w getAllProbabilities:', e);
                return null;
            }
        }

        // === 1. SPORTMONKS ===
        async function getSportmonksProb(id) {
            if (!SPORTMONKS_KEY || SPORTMONKS_KEY.includes('TU_WKLEJ')) return 65;
            try {
                const url = `${PROXY}https://api.sportmonks.com/v3/football/fixtures/${id}?include=statistics&api_token=${SPORTMONKS_KEY}`;
                const res = await fetch(url);
                if (!res.ok) return 60;
                const data = await res.json();
                const stats = data.data?.[0]?.statistics;
                const avg = stats ? ((stats.home?.corners || 0) + (stats.away?.corners || 0)) / 2 : 9;
                return Math.min(95, 50 + (avg - 9) * 10);
            } catch { return 60; }
        }

        // === 2. FOOTYSTATS ===
        async function getFootyStatsProb(leagueName) {
            try {
                const leagueMap = { 'Premier League': 2012, 'Ligue 1': 2015, 'Serie A': 2019 };
                const lid = leagueMap[leagueName.split(' ')[0]] || 2012;
                const url = `${PROXY}https://api.footystats.org/league-corners?key=${FOOTYSTATS_KEY}&league_id=${lid}`;
                const res = await fetch(url);
                if (!res.ok) return 62;
                const data = await res.json();
                return data.cornersAVG_overall > 10.5 ? 88 : 68;
            } catch { return 62; }
        }

        // === 3. API-FOOTBALL ===
        async function getApiFootballProb(id) {
            try {
                const url = `${PROXY}https://v3.football.api-sports.io/fixtures/statistics?fixture=${id}`;
                const res = await fetch(url, { headers: { 'x-apisports-key': API_FOOTBALL_KEYS[currentKeyIndex] } });
                if (!res.ok) return 58;
                const data = await res.json();
                if (!data.response.length) return 58;
                const hc = data.response[0].statistics.find(s => s.type === 'Corner Kicks')?.value || 0;
                const ac = data.response[1].statistics.find(s => s.type === 'Corner Kicks')?.value || 0;
                const avg = (hc + ac) * 2.2;
                return Math.min(95, 45 + (avg - 8) * 12);
            } catch { return 58; }
        }

        // === 4. TOTALCORNER.COM (scrap) ===
        async function getTotalCornerProb(home, away) {
            try {
                const url = `${PROXY}https://www.totalcorner.com/match/corner-stats/${home.replace(/ /g,'-')}-vs-${away.replace(/ /g,'-')}`;
                const html = await fetch(url).then(r => r.text());
                const match = html.match(/Average Corners per Match.*?(\d+\.\d+)/s);
                const avg = match ? parseFloat(match[1]) : 9.5;
                return Math.min(95, 50 + (avg - 9) * 12);
            } catch { return 70; }
        }

        // === 5. BETONCORNERS.COM (scrap) ===
        async function getBetOnCornersProb(home) {
            try {
                const url = `${PROXY}https://www.betoncorners.com/statistics/${home.toLowerCase().replace(/ /g,'-')}`;
                const html = await fetch(url).then(r => r.text());
                const match = html.match(/Average Corners per Game.*?(\d+\.\d+)/s);
                const avg = match ? parseFloat(match[1]) : 9;
                return Math.min(95, 55 + (avg - 9) * 15);
            } catch { return 68; }
        }

        // === 6. CORNER-STAT.COM (scrap) ===
        async function getCornerStatProb(home, away) {
            try {
                const url = `${PROXY}https://corner-stat.com/match/${home.toLowerCase().replace(/ /g,'-')}-vs-${away.toLowerCase().replace(/ /g,'-')}`;
                const html = await fetch(url).then(r => r.text());
                const match = html.match(/Corners per match.*?(\d+\.\d+)/s);
                const avg = match ? parseFloat(match[1]) : 9.2;
                return Math.min(95, 48 + (avg - 9) * 14);
            } catch { return 66; }
        }

        function displayResults() {
            const table = document.getElementById('predictions');
            table.style.display = 'table';
            let html = `<tr><th>Mecz</th><th>Liga</th><th>≈örednia %</th><th>ZGODNO≈öƒÜ</th><th>Link</th><th>Status</th></tr>`;

            if (predictions.length === 0) {
                html += `<tr><td colspan="6">Brak mecz√≥w z ‚â•50% zgodno≈õciƒÖ.</td></tr>`;
            } else {
                predictions.forEach(p => {
                    const cls = p.agree >= 80 ? 'high' : p.agree >= 70 ? 'medium' : '';
                    html += `<tr>
                        <td><strong>${p.match}</strong></td>
                        <td>${p.league}</td>
                        <td>${p.avgProb}%</td>
                        <td class="${cls}">${p.agree}%</td>
                        <td><a href="${p.flashscore}" target="_blank" class="link">Flashscore</a></td>
                        <td class="pending" id="s-${p.id}">${p.status}</td>
                    </tr>`;
                });
            }
            table.innerHTML = html;
            document.getElementById('info').textContent = `Znaleziono ${predictions.length} typ√≥w (‚â•50%)!`;
            updateStats();
        }

        async function verifyAll() {
            hits = 0; total = 0;
            for (let p of predictions) {
                const el = document.getElementById(`s-${p.id}`);
                if (!el) continue;
                try {
                    const res = await fetch(`${PROXY}https://v3.football.api-sports.io/fixtures?id=${p.id}`, {
                        headers: { 'x-apisports-key': API_FOOTBALL_KEYS[currentKeyIndex] }
                    });
                    const data = await res.json();
                    const fix = data.response[0];
                    if (fix.fixture.status.short === 'FT') {
                        const statsRes = await fetch(`${PROXY}https://v3.football.api-sports.io/fixtures/statistics?fixture=${p.id}`, {
                            headers: { 'x-apisports-key': API_FOOTBALL_KEYS[currentKeyIndex] }
                        });
                        const stats = await statsRes.json();
                        const hc = stats.response[0].statistics.find(s => s.type === 'Corner Kicks')?.value || 0;
                        const ac = stats.response[1].statistics.find(s => s.type === 'Corner Kicks')?.value || 0;
                        const totalC = hc + ac;
                        const isOver = totalC > 9.5;
                        el.textContent = isOver ? `OVER (${totalC})` : `UNDER (${totalC})`;
                        el.parentElement.className = isOver ? 'hit' : 'miss';
                        if (isOver) hits++;
                        total++;
                    } else {
                        el.textContent = 'W trakcie';
                    }
                } catch { }
            }
            updateStats();
        }

        function updateStats() {
            const hitRate = total > 0 ? Math.round((hits / total) * 100) : 0;
            const roi = total > 0 ? ((hits * 1.85) - (total - hits)).toFixed(2) : 0;
            document.getElementById('stats').innerHTML = `
                <strong>Hit Rate: ${hitRate}%</strong> | 
                <strong>ROI: ${roi > 0 ? '+' : ''}${roi} z≈Ç</strong> (kurs 1.85)
            `;
            updateChart();
        }

        function updateChart() {
            const ctx = document.getElementById('chart').getContext('2d');
            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Trafienia', 'Pud≈Ça'],
                    datasets: [{
                        data: [hits, total - hits],
                        backgroundColor: ['#4CAF50', '#f44336'],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: { responsive: true, plugins: { legend: { position: 'bottom', labels: { color: '#fff' } } } }
            });
        }

        // Auto co 30 min
        setInterval(verifyAll, 1800000);
    </script>
</body>
</html>