<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corners Predictor - API-Football</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f0f23, #1a1a2e);
            color: #fff;
            text-align: center;
            padding: 20px;
            min-height: 100vh;
        }
        h1 { color: #ff5722; font-size: 2em; margin-bottom: 10px; }
        .subtitle { color: #aaa; margin-bottom: 20px; }
        .buttons { margin: 20px 0; }
        button {
            background: #ff5722; color: white; border: none; padding: 14px 28px; margin: 8px;
            font-size: 16px; font-weight: bold; cursor: pointer; border-radius: 12px;
            transition: all 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        button:hover { background: #e64a19; transform: translateY(-2px); }
        button:disabled { background: #666; cursor: not-allowed; }
        table {
            width: 100%; max-width: 1200px; margin: 25px auto; border-collapse: collapse;
            background: #1a1a2e; border-radius: 12px; overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            display: block; max-height: 600px; overflow-y: auto;
        }
        table thead { position: sticky; top: 0; background: #16213e; z-index: 10; }
        table tbody { display: table; width: 100%; }
        th { background: #16213e; padding: 16px; font-weight: bold; text-transform: uppercase; font-size: 0.9em; }
        td { padding: 14px; border-bottom: 1px solid #333; }
        tr:hover { background: #222840; }
        .hit { background: #2e7d32 !important; color: #fff; }
        .miss { background: #c62828 !important; color: #fff; }
        .pending { background: #ff8f00; color: #000; font-weight: bold; }
        #info {
            font-size: 1.1em; margin: 20px 0; padding: 15px;
            background: rgba(255, 87, 34, 0.1); border-radius: 12px; display: inline-block;
        }
        .loader {
            display: inline-block; width: 20px; height: 20px;
            border: 3px solid #f3f3f3; border-top: 3px solid #ff5722;
            border-radius: 50%; animation: spin 1s linear infinite; margin-left: 10px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error { color: #f44336; background: rgba(244, 67, 54, 0.1); padding: 10px; border-radius: 8px; margin: 10px 0; }
        .limit-info { color: #ffa500; font-size: 0.9em; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Corners Predictor <span id="version">v1.00</span> <span id="loader" class="loader" style="display:none;"></span></h1>
        <p class="subtitle">‚úÖ API-Football Only - Over 9.5 Corners Predictor</p>

        <div class="buttons">
            <button id="btn-today">POBIERZ MECZE NA DZI≈ö</button>
        </div>

        <p id="info">Kliknij przycisk, by pobraƒá mecze na dzi≈õ...</p>
        <p id="limit-info" class="limit-info"></p>

        <table id="matches" style="display:none;">
            <thead>
            <tr>
                <th>Mecz</th>
                <th>Liga</th>
                    <th>Godzina</th>
                <th>Status</th>
                    <th>Prawdopodobie≈Ñstwo</th>
            </tr>
            </thead>
            <tbody id="matches-body">
            </tbody>
        </table>

        <footer style="margin-top: 50px; font-size: 0.9em; color: #888;">
            <p>Corners Predictor ¬© 2025 | API-Football Only</p>
        </footer>
    </div>

    <script>
        // === KONFIGURACJA API-FOOTBALL ===
        const API_FOOTBALL_KEY = 'fb9b429fc619754e0ce3ad2a9e5be39b';
        const API_FOOTBALL_BASE_URL = 'https://v3.football.api-sports.io';
        
        let matches = [];
        let requestsUsed = 0;
        let requestsLimit = 100;

        // Za≈Çaduj wersjƒô przy starcie
        async function loadVersion() {
            try {
                const response = await fetch('version.json?t=' + Date.now());
                const data = await response.json();
                document.getElementById('version').textContent = 'v' + data.version;
                console.log('üìå Wersja aplikacji:', data.version, '| Ostatnia aktualizacja:', data.updated);
            } catch (e) {
                console.warn('Nie mo≈ºna za≈Çadowaƒá wersji:', e);
            }
        }
        loadVersion();
        
        // Event listener dla przycisku
        document.getElementById('btn-today').addEventListener('click', loadMatchesForToday);

        // === ETAP 3: Pobieranie mecz√≥w na dzie≈Ñ ===
        async function loadMatchesForToday() {
            const loader = document.getElementById('loader');
            const info = document.getElementById('info');
            const limitInfo = document.getElementById('limit-info');
            const btn = document.getElementById('btn-today');
            
            loader.style.display = 'inline-block';
            info.textContent = 'üîç Pobieranie mecz√≥w z API-Football...';
            btn.disabled = true;
            
            try {
                const today = new Date().toISOString().split('T')[0];
                const url = `${API_FOOTBALL_BASE_URL}/fixtures?date=${today}&timezone=Europe/Warsaw`;
                
                console.log('üì° Pobieranie mecz√≥w na:', today);
                console.log('üì° URL:', url);
                
                const response = await fetch(url, {
                    headers: {
                        'x-apisports-key': API_FOOTBALL_KEY
                    }
                });
                
                // Sprawd≈∫ limit zapyta≈Ñ z headers
                const remaining = response.headers.get('x-ratelimit-requests-remaining');
                const limit = response.headers.get('x-ratelimit-requests-limit');
                if (remaining && limit) {
                    requestsUsed = parseInt(limit) - parseInt(remaining);
                    requestsLimit = parseInt(limit);
                    limitInfo.textContent = `üìä Limit zapyta≈Ñ: ${requestsUsed}/${requestsLimit} u≈ºytych dzisiaj`;
                }
                
                if (!response.ok) {
                    if (response.status === 429) {
                        throw new Error('‚ùå OsiƒÖgniƒôto limit zapyta≈Ñ (100/dzie≈Ñ). Limit odnowi siƒô jutro o p√≥≈Çnocy UTC.');
                    }
                    throw new Error(`B≈ÇƒÖd HTTP ${response.status}: ${response.statusText}`);
                }
                
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    throw new Error('Odpowied≈∫ nie jest JSON');
                }
                
                const data = await response.json();
                
                console.log('üì¶ Odpowied≈∫ API-Football:', data);
                
                if (!data.response || !Array.isArray(data.response)) {
                    throw new Error('Nieprawid≈Çowa struktura odpowiedzi');
                }
                
                matches = data.response;
                console.log(`‚úÖ Pobrano ${matches.length} mecz√≥w`);
                
                displayMatches(matches);
                
                info.innerHTML = `‚úÖ Pobrano <strong>${matches.length} mecz√≥w</strong> na dzi≈õ (${today})`;
                
            } catch (error) {
                console.error('‚ùå B≈ÇƒÖd:', error);
                info.innerHTML = `<span class="error">${error.message}</span>`;
                document.getElementById('matches').style.display = 'none';
            } finally {
                loader.style.display = 'none';
                btn.disabled = false;
            }
        }

        // === Wy≈õwietlanie mecz√≥w w tabeli ===
        function displayMatches(matchesList) {
            const table = document.getElementById('matches');
            const tbody = document.getElementById('matches-body');
            
            table.style.display = 'block';
            tbody.innerHTML = '';
            
            if (matchesList.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5">Brak mecz√≥w na dzi≈õ</td></tr>';
                    return;
                }
                    
                    // Sortuj po lidze, potem po godzinie
            const sortedMatches = [...matchesList].sort((a, b) => {
                        const leagueA = a.league?.name || 'ZZZ';
                        const leagueB = b.league?.name || 'ZZZ';
                        if (leagueA !== leagueB) return leagueA.localeCompare(leagueB);
                        return (a.fixture?.timestamp || 0) - (b.fixture?.timestamp || 0);
                    });
                    
                    sortedMatches.forEach(match => {
                const homeTeam = match.teams?.home?.name || 'Unknown';
                const awayTeam = match.teams?.away?.name || 'Unknown';
                const leagueName = match.league?.name || 'Unknown League';
                const status = match.fixture?.status?.short || 'NS';
                const timestamp = match.fixture?.timestamp;
                
                let time = 'N/A';
                if (timestamp) {
                    const date = new Date(timestamp * 1000);
                                time = date.toLocaleTimeString('pl-PL', { hour: '2-digit', minute: '2-digit' });
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${homeTeam} vs ${awayTeam}</strong></td>
                            <td>${leagueName}</td>
                            <td>${time}</td>
                    <td class="pending">${status}</td>
                    <td>-</td>
                `;
                tbody.appendChild(row);
            });
        }
    </script>
</body>
</html>
